@startuml MatrixLib Class Hierarchy

' MatrixLib Class Hierarchy Diagram
' Shows relationships between core classes

title MatrixLib Class Hierarchy

skinparam classAttributeIconSize 0
skinparam packageStyle rectangle
skinparam backgroundColor #FEFEFE

package "matrixlib" {

    class "Vec<T, N>" as Vec {
        + enum {X=0, Y=1, Z=2, W=3}
        + alignas(16) T data[N]
        --
        + Vec()
        + Vec(T...)
        + T& operator[](uint32_t)
        + {static} constexpr size_t size()
        + Vec operator+(Vec)
        + Vec operator-(Vec)
        + Vec operator*(T)
        + T dot(Vec)
        + Vec cross(Vec)
        + T magnitude()
        + Vec normalized()
        + Vec safe_normalized(T epsilon)
        + T x(), y(), z(), w()
        + Vec lerp(Vec, T)
        + bool approx_equal(Vec, T epsilon)
    }

    class "Mat<T, R, C>" as Mat {
        + alignas(16) T data[R * C]
        --
        + Mat()
        + RowProxy operator[](uint32_t)
        + {static} constexpr size_t size()
        + {static} constexpr size_t rows()
        + {static} constexpr size_t cols()
        + Mat operator+(Mat)
        + Mat operator-(Mat)
        + Mat operator*(Mat)
        + Vec<T,R> operator*(Vec<T,C>)
        + Mat<T,C,R> transpose()
        + T frobenius_norm()
        + Mat normalized()
        + Vec<T,C> row(uint32_t)
        + Vec<T,R> col(uint32_t)
        + bool approx_equal(Mat, T epsilon)
    }

    class "SquareMat<T, N>" as SquareMat {
        --
        + T trace()
        + uint32_t rank()
        + T determinant()
        + SquareMat inverse()
        + {static} SquareMat identity()
        + {static} SquareMat scale(Vec<T,N>)
    }

    class "SquareMat<T, 2>" as SquareMat2 {
        --
        + {static} SquareMat rotation(T angle)
        + {static} SquareMat scale(T x, T y)
    }

    class "SquareMat<T, 3>" as SquareMat3 {
        --
        + {static} SquareMat rotation_x(T angle)
        + {static} SquareMat rotation_y(T angle)
        + {static} SquareMat rotation_z(T angle)
        + {static} SquareMat rotation_axis_angle(Vec<T,3>, T)
        + {static} SquareMat rotation_from_to(Vec<T,3>, Vec<T,3>)
        + {static} SquareMat look_at(Vec<T,3>, Vec<T,3>)
        + Vec<T,3> euler_angles()
        + {static} SquareMat scale(Vec<T,3>)
    }

    class "SquareMat<T, 4>" as SquareMat4 {
        --
        + {static} SquareMat translation(Vec<T,3>)
        + {static} SquareMat scale(Vec<T,4>)
        + {static} SquareMat scale(T)
    }

    class "Quaternion<T>" as Quaternion {
        + enum {X=0, Y=1, Z=2, W=3}
        + alignas(16) T data[4]
        --
        + Quaternion()
        + Quaternion(T w, T x, T y, T z)
        + T& operator[](uint32_t)
        + Quaternion operator+(Quaternion)
        + Quaternion operator-(Quaternion)
        + Quaternion operator*(Quaternion)
        + Quaternion operator*(T)
        + T w(), x(), y(), z()
        + Vec<T,3> vec()
        + void set_vec(Vec<T,3>)
        + Quaternion conjugate()
        + T norm()
        + Quaternion normalized()
        + Quaternion inverse()
        + Vec<T,3> rotate(Vec<T,3>)
        + T dot(Quaternion)
        + {static} Quaternion identity()
        + {static} Quaternion from_axis_angle(Vec<T,3>, T)
        + SquareMat<T,3> to_matrix()
        + Quaternion lerp(Quaternion, T)
        + Quaternion slerp(Quaternion, T)
        + bool approx_equal(Quaternion, T epsilon)
    }

    ' Type aliases
    note as TypeAliases
        **Type Aliases**
        Vec2<T> = Vec<T, 2>
        Vec3<T> = Vec<T, 3>
        Vec4<T> = Vec<T, 4>

        Vec2f = Vec<float, 2>
        Vec3f = Vec<float, 3>
        Vec4f = Vec<float, 4>

        Mat2<T> = SquareMat<T, 2>
        Mat3<T> = SquareMat<T, 3>
        Mat4<T> = SquareMat<T, 4>

        Mat2f = SquareMat<float, 2>
        Mat3f = SquareMat<float, 3>
        Mat4f = SquareMat<float, 4>

        Quatf = Quaternion<float>
        Quatd = Quaternion<double>
    end note
}

' Relationships
Mat <|-- SquareMat : extends
SquareMat <|-- SquareMat2 : specializes
SquareMat <|-- SquareMat3 : specializes
SquareMat <|-- SquareMat4 : specializes

Quaternion ..> Vec : uses Vec<T,3>
Quaternion ..> SquareMat3 : converts to
SquareMat3 ..> Quaternion : converts from

Mat ..> Vec : multiplies

TypeAliases .. Vec
TypeAliases .. SquareMat
TypeAliases .. Quaternion

note right of Vec
    **SIMD Optimized**
    - NEON: Vec<float, 2/3/4>
    - CMSIS-DSP: all float types

    **Alignment**
    alignas(16) for SIMD
end note

note right of Quaternion
    **Memory Layout**
    [x, y, z, w]

    Compatible with Vec<T,3>
    via vec() accessor
end note

note right of SquareMat
    **Row-major storage**
    data[row * N + col]

    **Specializations**
    2×2, 3×3, 4×4
end note

@enduml
